{# Autor: João Victor Marques Favero #}
{% extends 'base.html' %} {# Estende o template base #}
{% load static %} {# Carrega arquivos estáticos #}

{% block title %}Identificação: {{ chave.nome }}{% endblock %} {# Define o título da página #}

{% block content %}
    <div class="chave-action-container"> {# Container para ações da chave #}
        <h2>Chave: {{ chave.nome }}</h2> {# Exibe o nome da chave #}

        {% if messages %} {# Verifica se há mensagens para exibir #}
            {% for message in messages %} {# Itera sobre as mensagens #}
                <p class="login-error" style="background-color: #fdd; border: 1px solid #d44; color: #d44; padding: 10px; border-radius: 4px; text-align: center; margin-bottom: 15px;">
                    {{ message }} {# Exibe a mensagem #}
                </p>
            {% endfor %}
        {% endif %}

        <p class="chave-status {% if chave.status == 'disponivel' %}status-disponivel{% else %}status-em-uso{% endif %}">
            Status Atual: {{ chave.get_status_display }} {# Exibe o status atual da chave #}
            {% if chave.portador_atual %} {# Verifica se há um portador atual #}
                (com {{ chave.portador_atual.username }}) {# Exibe o nome do portador atual #}
            {% endif %}
        </p>

        <div class="chave-actions"> {# Container para ações da chave #}
            
            {% if chave.status == 'disponivel' or chave.portador_atual != user %} {# Verifica se a chave está disponível ou se o usuário não é o portador atual #}
                <form method="post" action="{% url 'pegar_chave' pk=chave.pk %}" style="margin-bottom: 15px;"> {# Formulário para pegar a chave #}
                    {% csrf_token %} {# Token de segurança #}
                    <button type="submit" class="btn-pegar-chave">Estou responsável pela chave</button> {# Botão para pegar a chave #}
                </form>
                <a href="{% url 'index' %}" class="btn-voltar-index">Voltar</a> {# Link para voltar ao índice #}
            
            {% elif chave.portador_atual == user %} {# Verifica se o usuário é o portador atual #}
                 <p class="info-message">Você já está com esta chave.</p> {# Mensagem informando que o usuário já possui a chave #}
                 <a href="{% url 'index' %}" class="btn-voltar-index">Voltar a tela Inicial</a> {# Link para voltar à tela inicial #}
             
             {% endif %}
        </div>

    </div>
{% endblock %}